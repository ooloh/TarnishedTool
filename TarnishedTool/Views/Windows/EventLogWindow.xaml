<Window x:Class="TarnishedTool.Views.Windows.EventLogWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:controls="clr-namespace:TarnishedTool.Controls"
        xmlns:converters="clr-namespace:TarnishedTool.Converters"
        xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
        mc:Ignorable="d"
        WindowStyle="None"
        AllowsTransparency="True"
        Title="EventLogWindow" Height="450" Width="600"
        Style="{StaticResource DefaultWindowStyle}">

    <Window.Resources>
        <converters:LogEntryToBrushConverter x:Key="LogBrushConverter" />
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="30" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <controls:TitleBar Title="{Binding Title, RelativeSource={RelativeSource AncestorType=Window}}" />


        <Grid Grid.Row="1">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250" />
                <ColumnDefinition Width="350" />
            </Grid.ColumnDefinitions>

            <ListBox Grid.Column="0"
                     x:Name="LogListBox"
                     SelectionMode="Multiple"
                     ItemsSource="{Binding LogEntries}"
                     VirtualizingPanel.IsVirtualizing="True"
                     VirtualizingPanel.VirtualizationMode="Recycling"
                     ScrollViewer.ScrollChanged="LogListBox_ScrollChanged">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding DisplayText}"
                                   Foreground="{Binding Converter={StaticResource LogBrushConverter}}" />
                    </DataTemplate>
                </ListBox.ItemTemplate>
                <ListBox.ItemContainerStyle>
                    <Style TargetType="ListBoxItem">
                        <EventSetter Event="MouseDoubleClick" Handler="Event_DoubleClick" />
                    </Style>
                </ListBox.ItemContainerStyle>
                <ListBox.InputBindings>
                    <KeyBinding Command="ApplicationCommands.SelectAll"
                                Modifiers="Ctrl"
                                Key="A" />
                </ListBox.InputBindings>  
            </ListBox>

            <Grid Grid.Column="1">

                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBlock
                    Grid.Row="0"
                    Grid.Column="0"
                    Margin="10, 10, 0, 0"
                    Text="Log Options" />

                <CheckBox
                    Grid.Row="1"
                    Grid.Column="0"
                    Margin="10, 10, 0, 0"
                    Content="Log Unique Event IDs"
                    IsChecked="{Binding IsLogUniqueIdsEnabled}" />

                <StackPanel Grid.Row="1"
                            Grid.Column="1"
                            Margin="10, 10, 0, 0"
                            Orientation="Horizontal">
                    <xctk:IntegerUpDown
                        Value="{Binding LogLimit, UpdateSourceTrigger=PropertyChanged}"
                        Width="80"
                        Maximum="20000" />

                    <TextBlock Text="Log Limit" VerticalAlignment="Center"
                               Margin="10, 0, 0, 0">
                    </TextBlock>
                </StackPanel>

                <Button
                    Grid.Row="2"
                    Grid.Column="0"
                    Margin="10, 10, 0, 0"
                    Content="Clear Log"
                    Command="{Binding ClearCommand}" />

                <Button Grid.Row="2"
                        Grid.Column="1"
                        VerticalAlignment="Bottom"
                        Command="{Binding ClearUniqueCommand}"
                        Margin="10, 10, 0, 0"
                        Content="Clear unique IDs" />

                <Grid Grid.Row="3"
                      Grid.Column="0">
                    <TextBox
                        Text="{Binding EventIdToExclude, UpdateSourceTrigger=PropertyChanged}"
                        VerticalAlignment="Center"
                        Height="30"
                        Width="150" FontSize="12" Margin="10, 10, 0, 0"
                        MaxLength="10"
                        x:Name="ExcludeEventBox" />
                    <TextBlock IsHitTestVisible="False" Text="Input event to exclude" VerticalAlignment="Center"
                               HorizontalAlignment="Left" Margin="25,10,0,0" Foreground="DarkGray">
                        <TextBlock.Style>
                            <Style TargetType="{x:Type TextBlock}">
                                <Setter Property="Visibility" Value="Collapsed" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Text, ElementName=ExcludeEventBox}" Value="">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>

                </Grid>

                <Button Grid.Row="3"
                        Grid.Column="1"
                        VerticalAlignment="Center"
                        Margin="10, 10, 0, 0"

                        Command="{Binding AddToExcludeCommand}"
                        Content="Add to Exclude" />

                <Button Grid.Row="4"
                        Grid.Column="0"
                        Content="Export Excluded IDs"
                        Command="{Binding ExportExcludedCommand}"
                        Margin="10, 10, 0, 0" />

                <Button Grid.Row="4"
                        Grid.Column="1"
                        Command="{Binding ImportExcludedCommand}"
                        Margin="10, 10, 0, 0"
                        Content="Import Excluded IDs" />

                <TextBlock Grid.Row="5"
                           Grid.Column="0"
                           Margin="10, 10, 0, 0"
                           Text="Excluded Event IDs" />

                <ListBox
                    Margin="10"
                    Grid.Row="6"
                    Grid.Column="0"
                    MaxHeight="200"
                    ItemsSource="{Binding ExcludedEventIds}"
                    SelectedItem="{Binding SelectedExcludedId}"
                    Height="200">
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <EventSetter Event="MouseDoubleClick" Handler="ExcludedEvent_DoubleClick" />
                        </Style>
                    </ListBox.ItemContainerStyle>
                </ListBox>


                <Grid Grid.Row="6"
                      Grid.Column="1">
                    <StackPanel VerticalAlignment="Top" Margin="10, 10, 0, 0">
                        
                        <Button
                            Content="Clear all excluded IDs"
                            Command="{Binding ClearExcludedCommand}" />
                        <Button
                            Margin="0, 10, 0, 0"
                            Content="Remove ID from exclude"
                            Command="{Binding RemoveFromExcludedCommand}" />
                    </StackPanel>
                    
                    <Button
                        Height="35"
                        VerticalAlignment="Bottom"
                        Margin="10, 10, 0, 0"
                        Content="{Binding PauseResumeText}"
                        Command="{Binding PauseResumeCommand}" />

                </Grid>
            </Grid>
        </Grid>
    </Grid>
</Window>